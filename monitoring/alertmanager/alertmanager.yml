route:
  group_by: ['alertname', 'severity', 'service']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 12h
  receiver: 'default-receiver'
  
  routes:
    # 严重告警立即发送
    - match:
        severity: critical
      receiver: 'critical-receiver'
      continue: true
    
    # 警告告警可以延迟
    - match:
        severity: warning
      receiver: 'warning-receiver'
      group_wait: 30s

receivers:
  # 默认接收器（控制台日志）
  - name: 'default-receiver'
    webhook_configs:
      - url: 'http://localhost:5001/alert'
        send_resolved: true

  # 严重告警接收器
  - name: 'critical-receiver'
    # 企业微信（示例）
    # wechat_configs:
    #   - corp_id: 'YOUR_CORP_ID'
    #     to_party: '1'
    #     agent_id: 'YOUR_AGENT_ID'
    #     api_secret: 'YOUR_SECRET'
    
    # 钉钉（示例）
    # webhook_configs:
    #   - url: 'https://oapi.dingtalk.com/robot/send?access_token=YOUR_TOKEN'
    #     send_resolved: true
    
    # 邮件（示例）
    # email_configs:
    #   - to: 'admin@example.com'
    #     from: 'alertmanager@example.com'
    #     smarthost: 'smtp.gmail.com:587'
    #     auth_username: 'your-email@gmail.com'
    #     auth_password: 'your-password'

  # 警告告警接收器
  - name: 'warning-receiver'
    webhook_configs:
      - url: 'http://localhost:5001/alert'
        send_resolved: true

inhibit_rules:
  # 如果服务已经停止，抑制其他告警
  - source_match:
      severity: 'critical'
      alertname: 'ServiceDown'
    target_match:
      severity: 'warning'
    equal: ['job']
