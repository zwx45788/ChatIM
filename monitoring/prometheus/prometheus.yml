global:
  scrape_interval: 15s # 默认抓取间隔
  evaluation_interval: 15s # 告警规则评估间隔
  external_labels:
    cluster: 'chatim'
    environment: 'production'

# 告警规则文件
rule_files:
  - 'alert-rules.yml'

# Alertmanager 配置
alerting:
  alertmanagers:
    - static_configs:
        - targets:
            - alertmanager:9093

# 抓取配置
scrape_configs:
  # Prometheus 自身
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  # API Gateway
  - job_name: 'chatim-api-gateway'
    static_configs:
      - targets: ['api-gateway:9090']
    metric_relabel_configs:
      # 删除高基数标签（如果需要）
      - source_labels: [__name__]
        regex: 'chatim_.*'
        action: keep

  # Message Service
  - job_name: 'chatim-message-service'
    static_configs:
      - targets: ['message-service:9090']

  # User Service
  - job_name: 'chatim-user-service'
    static_configs:
      - targets: ['user-service:9090']

  # Group Service
  - job_name: 'chatim-group-service'
    static_configs:
      - targets: ['group-service:9090']

  # Friendship Service
  - job_name: 'chatim-friendship-service'
    static_configs:
      - targets: ['friendship-service:9090']

  # MySQL Exporter（可选）
  # - job_name: 'mysql'
  #   static_configs:
  #     - targets: ['mysql-exporter:9104']

  # Redis Exporter（可选）
  # - job_name: 'redis'
  #   static_configs:
  #     - targets: ['redis-exporter:9121']
